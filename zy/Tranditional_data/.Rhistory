library(tidycensus)
acs_2019 <- load_variables(year = 2023, dataset = "acs1")
acs_2023 <- load_variables(year = 2023, dataset = "acs1")
library(duckdb)
library(tidyverse)
setwd("C:/Users/zyang/OneDrive/Desktop/FARS/zy/Tranditional_data")
con <- dbConnect(duckdb::duckdb(), dbdir = "raw_data.duckdb")
dbListTables(con)
FARS2021<- dbGetQuery(con, "SELECT * FROM person2021")
FARS2021_filter<- FARS2021 %>%
select(ST_CASE,
STATE,
STATENAME,
COUNTY,
AGE,
AGENAME,
SEX,
INJ_SEV,
INJ_SEVNAME)
View(FARS2021_filter)
filter(INJ_SEV==4)
filter(INJ_SEV==4)
filter(INJ_SEV==4)
filter(INJ_SEV==4)
mutate(agegroup= case_when(AGE<5~1,
AGE>=5 & AGE<10~2,
AGE>=10 & AGE<15~3,
AGE>=15 & AGE<19~4,
AGE>=19 & AGE<200~5,
AGE>=200~6))
select(ST_CASE,
STATE,
STATENAME,
COUNTY,
AGE,
AGENAME,
SEX,
INJ_SEV,
INJ_SEVNAME)
FARS2021_filter<- FARS2021 %>%
select(ST_CASE,
STATE,
STATENAME,
COUNTY,
AGE,
AGENAME,
SEX,
INJ_SEV,
INJ_SEVNAME)
FARS2021_filter<- FARS2021_filter%>%
mutate(agegroup= case_when(AGE<5~1,
AGE>=5 & AGE<10~2,
AGE>=10 & AGE<15~3,
AGE>=15 & AGE<19~4,
AGE>=19 & AGE<200~5,
AGE>=200~6))
FARS2021_filter<- FARS2021_filter%>%
filter(INJ_SEV==4)
View(FARS2021_filter)
process_FARS_data <- function(data) {
# Select relevant columns
data_filtered <- data %>%
select(
ST_CASE,
STATE,
STATENAME,
COUNTY,
AGE,
AGENAME,
SEX,
INJ_SEV,
INJ_SEVNAME
)
# Add agegroup column
data_filtered <- data_filtered %>%
mutate(
agegroup = case_when(
AGE < 5 ~ 1,
AGE >= 5 & AGE < 10 ~ 2,
AGE >= 10 & AGE < 15 ~ 3,
AGE >= 15 & AGE < 19 ~ 4,
AGE >= 19 & AGE < 200 ~ 5,
AGE >= 200 ~ 6
)
)
# Filter rows where INJ_SEV is fatality
data_filtered <- data_filtered %>%
filter(INJ_SEV == 4)
return(data_filtered)
}
#test function
FARS2021_filtered <- process_FARS_data(FARS2021)
