library(tidycensus)
acs_2019 <- load_variables(year = 2023, dataset = "acs1")
acs_2023 <- load_variables(year = 2023, dataset = "acs1")
library(duckdb)
library(tidyverse)
setwd("C:/Users/zyang/OneDrive/Desktop/FARS/zy/Tranditional_data")
con <- dbConnect(duckdb::duckdb(), dbdir = "raw_data.duckdb")
dbListTables(con)
FARS2021<- dbGetQuery(con, "SELECT * FROM person2021")
FARS2021_filter<- FARS2021 %>%
select(ST_CASE,
STATE,
STATENAME,
COUNTY,
AGE,
AGENAME,
SEX,
INJ_SEV,
INJ_SEVNAME)
View(FARS2021_filter)
filter(INJ_SEV==4)
filter(INJ_SEV==4)
filter(INJ_SEV==4)
filter(INJ_SEV==4)
mutate(agegroup= case_when(AGE<5~1,
AGE>=5 & AGE<10~2,
AGE>=10 & AGE<15~3,
AGE>=15 & AGE<19~4,
AGE>=19 & AGE<200~5,
AGE>=200~6))
select(ST_CASE,
STATE,
STATENAME,
COUNTY,
AGE,
AGENAME,
SEX,
INJ_SEV,
INJ_SEVNAME)
FARS2021_filter<- FARS2021 %>%
select(ST_CASE,
STATE,
STATENAME,
COUNTY,
AGE,
AGENAME,
SEX,
INJ_SEV,
INJ_SEVNAME)
FARS2021_filter<- FARS2021_filter%>%
mutate(agegroup= case_when(AGE<5~1,
AGE>=5 & AGE<10~2,
AGE>=10 & AGE<15~3,
AGE>=15 & AGE<19~4,
AGE>=19 & AGE<200~5,
AGE>=200~6))
FARS2021_filter<- FARS2021_filter%>%
filter(INJ_SEV==4)
View(FARS2021_filter)
process_FARS_data <- function(data) {
# Select relevant columns
data_filtered <- data %>%
select(
ST_CASE,
STATE,
STATENAME,
COUNTY,
AGE,
AGENAME,
SEX,
INJ_SEV,
INJ_SEVNAME
)
# Add agegroup column
data_filtered <- data_filtered %>%
mutate(
agegroup = case_when(
AGE < 5 ~ 1,
AGE >= 5 & AGE < 10 ~ 2,
AGE >= 10 & AGE < 15 ~ 3,
AGE >= 15 & AGE < 19 ~ 4,
AGE >= 19 & AGE < 200 ~ 5,
AGE >= 200 ~ 6
)
)
# Filter rows where INJ_SEV is fatality
data_filtered <- data_filtered %>%
filter(INJ_SEV == 4)
return(data_filtered)
}
#test function
FARS2021_filtered <- process_FARS_data(FARS2021)
library(duckdb)
library(tidyverse)
setwd("C:/Users/zyang/OneDrive/Desktop/FARS/zy/Tranditional_data")
con <- dbConnect(duckdb::duckdb(), dbdir = "raw_data.duckdb")
FARS2022<- dbGetQuery(con, "SELECT * FROM person2022")
FARS2021<- dbGetQuery(con, "SELECT * FROM person2021")
FARS2020<- dbGetQuery(con, "SELECT * FROM person2020")
FARS2019<- dbGetQuery(con, "SELECT * FROM person2019")
FARS2018<- dbGetQuery(con, "SELECT * FROM person2018")
FARS2017<- dbGetQuery(con, "SELECT * FROM person2017")
FARS2016<- dbGetQuery(con, "SELECT * FROM person2016")
FARS2015<- dbGetQuery(con, "SELECT * FROM person2015")
FARS2014<- dbGetQuery(con, "SELECT * FROM person2014")
FARS2013<- dbGetQuery(con, "SELECT * FROM person2013")
FARS2012<- dbGetQuery(con, "SELECT * FROM person2012")
FARS2011<- dbGetQuery(con, "SELECT * FROM person2011")
FARS2010<- dbGetQuery(con, "SELECT * FROM person2010")
process_FARS_data <- function(data) {
# Select relevant columns
data_filtered <- data %>%
select(
ST_CASE,
STATE,
STATENAME,
COUNTY,
AGE,
AGENAME,
SEX,
INJ_SEV,
INJ_SEVNAME
)
# Add agegroup column
data_filtered <- data_filtered %>%
mutate(
agegroup = case_when(
AGE < 5 ~ 1,
AGE >= 5 & AGE < 10 ~ 2,
AGE >= 10 & AGE < 15 ~ 3,
AGE >= 15 & AGE < 19 ~ 4,
AGE >= 19 & AGE < 200 ~ 5,
AGE >= 200 ~ 6
)
)
# Filter rows where INJ_SEV is fatality
data_filtered <- data_filtered %>%
filter(INJ_SEV == 4)
return(data_filtered)
}
dbDisconnect(con, shutdown = TRUE)
FARS2022_filtered <- process_FARS_data(FARS2022)
View(FARS2022_filtered)
FARS2021_filtered <- process_FARS_data(FARS2021)
FARS2020_filtered <- process_FARS_data(FARS2020)
# Select relevant columns
data_filtered <- data %>%
select(
ST_CASE,
STATE,
STATENAME,
COUNTY,
AGE,
SEX,
INJ_SEV,
INJ_SEVNAME
)
process_FARS_data <- function(data) {
# Select relevant columns
data_filtered <- data %>%
select(
ST_CASE,
STATE,
STATENAME,
COUNTY,
AGE,
SEX,
INJ_SEV,
INJ_SEVNAME
)
# Add agegroup column
data_filtered <- data_filtered %>%
mutate(
agegroup = case_when(
AGE < 5 ~ 1,
AGE >= 5 & AGE < 10 ~ 2,
AGE >= 10 & AGE < 15 ~ 3,
AGE >= 15 & AGE < 19 ~ 4,
AGE >= 19 & AGE < 200 ~ 5,
AGE >= 200 ~ 6
)
)
# Filter rows where INJ_SEV is fatality
data_filtered <- data_filtered %>%
filter(INJ_SEV == 4)
return(data_filtered)
}
#use function
FARS2022_filtered <- process_FARS_data(FARS2022)
FARS2021_filtered <- process_FARS_data(FARS2021)
FARS2020_filtered <- process_FARS_data(FARS2020)
FARS2019_filtered <- process_FARS_data(FARS2019)
FARS2018_filtered <- process_FARS_data(FARS2018)
FARS2017_filtered <- process_FARS_data(FARS2017)
FARS2016_filtered <- process_FARS_data(FARS2016)
FARS2017_filtered <- process_FARS_data(FARS2017)
FARS2016_filtered <- process_FARS_data(FARS2016)
FARS2015_filtered <- process_FARS_data(FARS2015)
FARS2014_filtered <- process_FARS_data(FARS2014)
FARS2013_filtered <- process_FARS_data(FARS2013)
View(FARS2019_filtered)
dbDisconnect(con, shutdown = TRUE)
process_FARS_data <- function(data) {
# Select relevant columns
data_filtered <- data %>%
select(
ST_CASE,
STATE,
COUNTY,
AGE,
SEX,
INJ_SEV,
INJ_SEVNAME
)
# Add agegroup column
data_filtered <- data_filtered %>%
mutate(
agegroup = case_when(
AGE < 5 ~ 1,
AGE >= 5 & AGE < 10 ~ 2,
AGE >= 10 & AGE < 15 ~ 3,
AGE >= 15 & AGE < 19 ~ 4,
AGE >= 19 & AGE < 200 ~ 5,
AGE >= 200 ~ 6
)
)
# Filter rows where INJ_SEV is fatality
data_filtered <- data_filtered %>%
filter(INJ_SEV == 4)
return(data_filtered)
}
FARS2014_filtered <- process_FARS_data(FARS2014)
process_FARS_data <- function(data) {
# Select relevant columns
data_filtered <- data %>%
select(
ST_CASE,
STATE,
COUNTY,
AGE,
SEX,
INJ_SEV,
)
# Add agegroup column
data_filtered <- data_filtered %>%
mutate(
agegroup = case_when(
AGE < 5 ~ 1,
AGE >= 5 & AGE < 10 ~ 2,
AGE >= 10 & AGE < 15 ~ 3,
AGE >= 15 & AGE < 19 ~ 4,
AGE >= 19 & AGE < 200 ~ 5,
AGE >= 200 ~ 6
)
)
# Filter rows where INJ_SEV is fatality
data_filtered <- data_filtered %>%
filter(INJ_SEV == 4)
return(data_filtered)
}
# use the function
FARS2014_filtered <- process_FARS_data(FARS2014)
FARS2013_filtered <- process_FARS_data(FARS2013)
FARS2012_filtered <- process_FARS_data(FARS2012)
FARS2011_filtered <- process_FARS_data(FARS2011)
FARS2010_filtered <- process_FARS_data(FARS2010)
process_FARS_data2 <- function(data) {
# Select relevant columns
data_filtered <- data %>%
select(
ST_CASE,
STATE,
COUNTY,
AGE,
SEX,
INJ_SEV,
)
# Add agegroup column
data_filtered <- data_filtered %>%
mutate(
agegroup = case_when(
AGE < 5 ~ 1,
AGE >= 5 & AGE < 10 ~ 2,
AGE >= 10 & AGE < 15 ~ 3,
AGE >= 15 & AGE < 19 ~ 4,
AGE >= 19 & AGE < 200 ~ 5,
AGE >= 200 ~ 6
)
)
# Filter rows where INJ_SEV is fatality
data_filtered <- data_filtered %>%
filter(INJ_SEV == 4)
return(data_filtered)
}
# use the function
FARS2014_filtered <- process_FARS_data2(FARS2014)
process_FARS_data2020 <- function(data) {
# Select relevant columns
data_filtered <- data %>%
select(
ST_CASE,
STATE,
STATENAME,
COUNTY,
AGE,
INJ_SEV,
INJ_SEVNAME
)
# Add agegroup column
data_filtered <- data_filtered %>%
mutate(
agegroup = case_when(
AGE < 5 ~ 1,
AGE >= 5 & AGE < 10 ~ 2,
AGE >= 10 & AGE < 15 ~ 3,
AGE >= 15 & AGE < 19 ~ 4,
AGE >= 19 & AGE < 200 ~ 5,
AGE >= 200 ~ 6
)
)
# Filter rows where INJ_SEV is fatality
data_filtered <- data_filtered %>%
filter(INJ_SEV == 4)
return(data_filtered)
}
FARS2020_filtered <- process_FARS_data2020(FARS2020)
View(FARS2020_filtered)
