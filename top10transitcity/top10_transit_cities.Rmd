---
title: "transit cities"
author: "Zhanchao Yang"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidycensus)
library(tidyverse)
library(readxl)
```
##Data prepare
### Data input
```{r, message=FALSE,warning=FALSE}
FARS <- read.csv("data/mastersheetFARS.csv")
cbsa <- read_excel("data/cbsa_list.xlsx")
```

### Re-create the FIPS code and filter the data
filter to the year 2012-2022 and only include the important code
```{r}
FARS<-FARS %>%
  filter(YEAR>2011)%>%
  select(YEAR,STATE,COUNTY,fatality_count)
```

FIPS code creation
```{r}
FARS$FIPS<-sprintf("%02d%03d", FARS$STATE, FARS$COUNTY)
```

##CBSA
cbsa code filtering only include selecting counties
cities:  NYC, Chicago, Philadelphia, LA, D.C., Boston, Seattle, SF, Baltimore, Pittsburgh
cbsa code for 10 cities on the list 
`msa_codes <- c(35620, 16980, 37980, 31080, 47900, 14460, 42660, 41860, 12580, 38300)`

```{r}
MSA<- c(35620, 16980, 37980, 31080, 47900, 14460, 42660, 41860, 12580, 38300)
cbsa_10<-cbsa%>%
  filter(`CBSA Code` %in% MSA)%>%
  rename(cbsa_code= `CBSA Code`, cbsa_name= `CBSA Title`)

cbsa_10<- cbsa_10%>%
  select(cbsa_code,cbsa_name,`FIPS State Code`, `FIPS County Code`)%>%
  rename(STATE=`FIPS State Code`, COUNTY=`FIPS County Code`)
```


```{r}
cbsa_10$COUNTY<-as.numeric(cbsa_10$COUNTY)
cbsa_10$STATE<-as.numeric(cbsa_10$STATE)
cbsa_10$FIPS<-sprintf("%02d%03d", cbsa_10$STATE, cbsa_10$COUNTY)
```

Filtered out FARS Data
```{r}
FARS<-FARS%>%
  filter(FIPS %in% cbsa_10$FIPS)
```

### Aggregating the FARS by years and county
```{r, message=FALSE,warning=FALSE}
FARS_final<-FARS%>%
  group_by(YEAR,FIPS)%>%
  summarise(fatality_count=sum(fatality_count))
```



















## Top 10 Transit Cities (Counties level)

### filter to only 10 cities respective counties

New York City, NY (covers multiple counties):
- Bronx County: 36005
- Kings County (Brooklyn): 36047
- New York County (Manhattan): 36061
- Queens County: 36081
- Richmond County (Staten Island): 36085

**Question: Should we include the all five counties in the NYC?**

Chicago, IL (Cook County): 17031

Philadelphia, PA (Philadelphia County): 42101

Los Angeles, CA (Los Angeles County): 06037

Washington, D.C. (District of Columbia): 11001

Boston, MA (Suffolk County): 25025

Seattle, WA (King County): 53033

San Francisco, CA (San Francisco County): 06075

Baltimore City (independent): 24510

Pittsburgh, PA (Allegheny County): 42003
```{r}
county<- c("36005","36047","36061","36081","36085","17031","42101","06037","11001","25025","53033","06075","24510","42003")

FARS_county<-FARS_final%>%
  filter(FIPS %in% county)
```


